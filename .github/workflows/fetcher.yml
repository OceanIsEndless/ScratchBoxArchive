name: Download URLs Every Hour

on:
  schedule:
    # This cron expression will run the workflow every hour on the hour
    - cron: '0 * * * *'
  workflow_dispatch: # Allow manual triggers

jobs:
  download_urls:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # Step 2: Download files from URLs and save to a timestamped folder
    - name: Download files
      run: |
        # Ensure we're in the right directory (repository root)
        echo "Current working directory: $(pwd)"
        
        # Create a unique folder name based on current timestamp
        folder_name="downloaded_content_$(date +'%Y%m%d_%H%M%S')"
        mkdir -p "$folder_name"
        echo "Created folder: $folder_name"

        # Define URLs
        urls=("https://example.com/index.html", "scratchbox.grady.link/explore", "https://scratchbox.grady.link/api/project/K26OtTN2WDJ9/download")

        # Download each URL into the timestamped folder
        for url in "${urls[@]}"; do
          filename=$(basename "$url")
          echo "Downloading: $url"
          
          # Debugging: Show the output of curl
          curl -L -o "$folder_name/$filename" "$url" && echo "Downloaded $filename successfully" || echo "Failed to download $filename"
        done

    # Step 3: Commit and push downloaded files
    - name: Commit and push files
      run: |
        # Configure Git
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        
        # Check if the folder exists and files were downloaded
        echo "Checking folder: $(pwd)/$folder_name"

        # Check if files exist and then add them
        if [ -d "$folder_name" ]; then
          git add "$folder_name"/*
          
          # Commit and push only if there are changes
          git diff --cached --quiet || (git commit -m "Add downloaded files to $folder_name" && git push)
        else
          echo "No new files to commit."
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
