name: Download URLs Every Hour

on:
  schedule:
    # This cron expression will run the workflow every hour on the hour
    - cron: '0 * * * *'
  workflow_dispatch: # Allow manual triggers

jobs:
  download_urls:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # Step 2: Download files from URLs and save to a timestamped folder
    - name: Download files
      run: |
        # Ensure we're in the right directory (repository root)
        echo "Current working directory: $(pwd)"
        
        # Create a unique folder name based on current timestamp
        folder_name="downloaded_content_$(date +'%Y%m%d_%H%M%S')"
        mkdir -p "$folder_name"
        echo "Created folder: $folder_name"

        # Define URLs
        urls=("https://example.com/index.html")

        # Download each URL into the timestamped folder
        for url in "${urls[@]}"; do
          filename=$(basename "$url")
          echo "Downloading: $url"
          
          # Debugging: Show the output of curl
          curl -L -o "$folder_name/$filename" "$url" && echo "Downloaded $filename successfully" || echo "Failed to download $filename"
        done

    # Step 3: Commit and push downloaded files (force add files)
    - name: Commit and push files
      run: |
        # Configure Git
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        
        # Check if the folder exists and files were downloaded
        echo "Checking folder: $(pwd)/$folder_name"

        # Forcefully add all files in the new folder (even if untracked or ignored)
        git add -f "$folder_name"/*

        # Show the files being staged for commit
        echo "Staging files:"
        git ls-files --stage
        
        # Commit and push if changes are detected
        git diff --cached --quiet || (git commit -m "Add downloaded files to $folder_name" && git push)
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
